<script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"
    integrity="sha512-lInM/apFSqyy1o6s89K4iQUKg6ppXEgsVxT35HbzUupEVRh2Eu9Wdl4tHj7dZO0s1uvplcYGmt3498TtHq+log=="
    crossorigin=""></script>
<script>
  const map = L.map("map");
  L.tileLayer('https://cartodb-basemaps-{s}.global.ssl.fastly.net/dark_all/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="http://cartodb.com/attributions">CartoDB</a>',
    subdomains: 'abcd',
    maxZoom: 19
  }).addTo(map);
  const nyu = [40.73046499853991, -73.99250799849149];
  map.setView(nyu, 14);
  let popupContent;
  const places = [];// L.layerGroup();
  {% for node in site.data.nodes %}
    {% if node[1].coordinates %}
      popupContent = "<h4><a href='{{ site.baseurl }}{{ node[1].url }}'>{{ node[1].name }}</a></h4><ul>";
      {% if node[1].official-link %}
        popupContent = popupContent + "<li><a href='{{ node[1].official-link }}'>Official link</a></li>";
      {% endif %}
      {% if node[1].wikipedia-link %}
        popupContent = popupContent + "<li><a href='{{ node[1].wikipedia-link }}'>Wikipedia link</a></li>";
      {% endif %}
      popupContent = popupContent + "</ul>";
      const {{ node[0] }} = L.marker([{{ node[1].coordinates[0] }}, {{ node[1].coordinates[1] }}], { name: "{{ node[1].title }}" }).bindPopup(popupContent);
      places.push({{ node[0] }});
      {% endif %}
  {% endfor %}
  Layer = L.layerGroup(places).addTo(map);
</script>
